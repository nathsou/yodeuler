# Adapted from https://projectf.io/posts/verilog-sim-verilator-sdl/

VFLAGS = -O3 -DENABLE_INITIAL_MEM_ --x-assign fast --x-initial fast --noassert

all: VTop

VTop.mk: Top.sv
	verilator ${VFLAGS} -I./ Top.sv --top-module Top -cc --exe -j 0 wrapper.cpp -o sim

VTop: VTop.mk
	make -C ./obj_dir -f VTop.mk

Top.fir:
	cd .. && yodl Top.yodl "write_firrtl sim/Top.fir"

Top.sv: Top.fir
	firtool -O=release --format=fir --verilog -disable-all-randomization -strip-debug-info Top.fir -o Top.sv

clean:
	rm -rf obj_dir sim Top.sv Top.fir VTop.mk